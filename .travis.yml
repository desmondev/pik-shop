language: java
node_js:
- '0.10'
sudo: true
addons:
  ssh_known_hosts: domek.xyz
services:
- docker
- postgresql
jdk: oraclejdk8
before_script:
- psql -c "create database pik_shop_test;" -U postgres
- psql -c "create user pik_shop_test with password 'pik_shop';" -U postgres
- psql -c "grant all privileges on database pik_shop_test to pik_shop_test;" -U postgres
- "./scripts/pre_run"
script: "./scripts/run_build"
after_script: "./scripts/deploy_reports"
deploy:
  provider: script
  skip_cleanup: true
  script: "./scripts/run_deploy"
  on:
    branch: production
env:
  global:
  - secure: CVY623yjdgZhYntxXafl0LPjG/TvkMEpMLeuYf/snS5Un7NUYJXL4tKODRjNEW8UmVMkW7Euwbtm13i2q8nX0B15MywgEc4luqlMIgt7gKPEAXRS7UFAITXrEXYfJsndMrTstDgW4vV4q+oNt3hnJ4jbt7qKiTAK3l5T6Hx+aNbNS6i7UeYPUlBRGeFCSnThXFfXbo36R8Z5zNocjXJju5VKh/+yWiNzpQC+WHQR1NFV5zlod32phUwG7SqNndFbS5jIpLpMDPsdT5XAGS7U5tmCTOmdlAragM/iK4qD5cgM32eXdmnJ64+QHzSb7Bc+eWO9pYr6eDIVSEY2tlSu81Ryb0MSIfLUQQ+lx/yt+fM2tDgcolBftlHQqGDhni+2h39cvhaPbHTpXEoMeqBtos8NILg095k0AD0307aAWWWbeVuZ2s+8NBeTYe6CAn9Dqt51UHr/Rjre7iKFH82UlQftaoOIUIOR9uA8FlGpYGIuGuGcJB/cYmJJ1orhugfsILSLF9ZvwEN9Dd/NODneNzKaNIjC/v+6yAfzvpzh/ZlxqSkLMVjuEDL/3OpbTzrEKezdJVlVDyoUsjEkCs+BuluUmyjFpaJNhfdslH5e5c8Y3apdow+Id+OWKRGmpZBFb7mMnC6vZk7alEkhbsBFrF54EnbI2I/FuUmvb23c6fs=
  - secure: d/RWbvTO7q+vpQaWQiQRn7ysNa0+f69lqD3lK743pikfvh00A/nXM3sVpDT6kIKfDTd79vJ+hvy+zXuGIEJDgv/D1E5+P1BuJ0cp/R/iknbqD72mEXK8rdqnveIbrSsSxAUCpI/vWUYWqYYX8dc/Cw3ZI3k/zTAoIDa9AeJjXLoucKyd7FqUIJTsAgf1mOrAEBrOdKk2oTigRjPng30EcUlIxrL3efYD0jD8AT0mb0YWjR6PtSpnkiSP98p6d9TmVD/k0qzMbpHVgk7XIMxAVmyUbCujVqtjA0aTiNLMtRDQvndBIaygDx1LgsRMIspK0nkUHFEh+1SEyiW4DQCAvyyBjWhpMzdd+JdtUB1rAMLpjh3v1Rzh9zIBtxddRM8JTrDEX1//88r6NfR6Y0mKG2DJ+W18LIDoJjsSFEnKLGP5z6YLpdgxsJWjpkq72qS5zCtFav65BFmE/7+Y3u1ak3CprHwlYTozwmuSiu0Bdrf1NcQxMTVRm8pPEC0p98K8ekd/hwFODLA7Z9M7dVxtkGpYlt31iVXuls/EssXU0jCvx7jaEcB8wxV2PzUJ95ZtToHR2nXh1XLFwqmgF+6jzRR26lV4Hi9COPJoyZtngXnomRalzjI95RbJotaY0Mn8SgfRlPRjI9Bnwc60lu8Y92xlAIEgZCU98ust67RDn4Q=
  - secure: lED5RwRH1r/Uiv17T6luKyFP31AnPrPtagaPEDhQ2GijppQYZSvBBCrs7tjhHx9/kMw7X8Rqhw43rBEB4y7U5xR0PiPQJ8cq1g/GUO/KV5fKy3dzDuFVN2jVSbxAFH4NiPvoKzQWrNAdNDtNL1J0QupHmuixToWj7ygM2IRWBF+SqULMVxrRzLKvhtHMi2zcQGU+ghmViNymlYM0FNBJBpO3cmCRANaBGGMggPyarIithbupAyG5+/dQyw9ADcmAl0FdL6VAYDJ2VCheBIAZOp0haeVyhlUwdOsXmMS1znnZybaR7ncFfXRjU//A164FIS8y2F8kzzMXyKD375Iy+KcQfrMLjCYWzUlg6z+ePBh4rge8JjEejO+mzcdL8IndiurOmFvbc7FzuVisZmoJSWhHYKxy643vRJfGfctewBiriTwQBZMmeCdITlg5lZ4xSDkHLTgydeCRjwfGgmbeVxnM1pWk9xSCemS9xpHAvNYoio92qHarU4uxUHABzyLDt/F9T8Z044oWioLlzw02o/d/IXj4C75qRJvGVmmWCc4aviP9FLIqfZUA4dUqDnA94pDDcGged84to/onnbt2o0Y2F8cKARDXdgURtileWe4NPSMa+gJODnbLBWa5pxzkLwsWBIk0+vppM25gc7aU65wU4Hhal7bR3+7ScfOgpBg=
  - secure: YWLt6uHDWrvpsWrWxUSMdKhLdbyKsjmyHxvf7WZO0KjhmjCmKrOGj3micgm9Qv2pZBCMe4/hcAFqbuzkUJmtD/qSlEEK4eKL5oKz+8WKmk9wlHCzW9W5oznzsZMjEjIM0YaCcgSrtZXFNdZ/MBAyEBWwtQo2BaSQqr3GPFX1i5IJjtVfrLPnW4QA94eCZHEvS5r6Wip+oy57JeZr95Er2/sp7pCunQ3MsF2WC23bZwqI4HqoCXn/pLwis2bHobR2XBaWOVtC2dv4r3XdUPE6iQkrXoWUSzbt0/gUz8rq/yMWm/t7nru3/rxsmi74e1YFTw/mpWXaJdPJrhdZZVTvNFpy0k8t0vdteSRoGUrWn1OXVYDg4VO2OSBqz841/HJIB57Kyc5kDvkOoZv9LXp0BOEhXo5KpEy30edXs0NXobV5t/OpuEMXzNCwJhLKQXWYpJuSugnJv6334k2MM6z/PsPHeTdynRNq+R6Nfz0fu4nKCLZQ1GdXVtNX2Y4xO+6OToU4IaFR6/ihN7e3s0JqyHbel7rGGtSvh7pWU4hpl0j9f7br87O1PjAuTst4zfrTlKBRU5JQrONXw9PXaUSRMuDD5ys77CQB/2eBfga+xLSxS4EfphBHf4C562brannXQh3iai79OqgvMZHUjLZlTFjaPDa9KYOLIpqOCy8FrJc=
  - secure: QvAusQ0EbvB/Wm48S4zrW+2giAHwvdg0ZUzSFBEgPdGdHZUH3MzwcrLIzFf0fBcQu6v4zAGfiG+7QJY7Z6vhOhlzvejRR2SVPdLragUPJFpqb7tu+mNJ71cHBgXMZpGxBthsFiOeWx33Nl/QxHX4B/9T1LX0uL2jaKf956tB24hiDt1ur8hkjQA5xQHHh0nk0w0c1uNYBNIXpsv6IW24EK5H1PEPgjjM3izSA9Jl8DQQgf+PhAPK5GPRqQqCJ6Tz+BubYoMgOZCjNuvHqnPg0CibII1vvjrmvszVvYnV+B/ouMt1Kg2jnM/a6lNOxOcXDJdTvGSPe9GPMGt+ZekLNCEZ71o0ROD0EhZEKPsbQBmmfo5un2wiHrxGm8plFWCH0dY4jo3AI843CdvLfefzwy/qtEKYYh1kuoxiJUWa6+QRzKSjokjdJa50kthUgp9bifT3S0TFdU3uulMy+HhuKSIIYo+8Mixtw++A/ZXib1YvDFS1t3JmuU29xlZfG2CR9FFyBRokWT9ksjAiHvrQ2GWTPzgt3I2y8glHhAMf52OQlECq6AFyyFtnEesRsQD3xX3sHsxMaPidAOxA5yM2r8URS9KDXNEtUvF7H55nfjhi9Fcu4qjSB+cYQgsKO9Hu3uJjD9wuS31sxM0DrgedHrkakuzSuu5KRTaaBX7KjKU=
  - secure: MQ7duX8m8h5EutprajzAVMtPe5AXLSt15zMksPv/0YNO+/X6h6oM7IYBI2j4ctYrwWudBdeeKw1wTOHZV6qMTkGzaf11Fq08hy2lkqD9sLLJbZzIGeq8wBZEYPFbrBLHugLr39Io7G/jvB04jl31V799hT8idjjYHcBNyooYUyHtBEtat0GFR+jpRAo2Nja+JTW7W/ieOfhaASMfAkmn7yhh2ObzVh7BpjvUAXH1skLy+FApEatPpu+e0ezHPoFT4IRC+b7X4mWatF9kFobIB2lZIQo1UgFQ5kO1oIn25aCWd7pkh2IdKY9Oncg8Fa3qiqUgeN2Ss2tPqfjj561FkfSvcO0C3juKoDi8ziISyBz0f+unKE7m1JrO/6h0xaiUwqOojNNMUVnm5Pu06TX3ilkbjhQmzQOgBKv6GVmxC/XUXBaEbAHc4/5blON5knFIpAKznRSe2u2u3DRrAlDQ7F6O+h3qbXxYPNlaWOXj8YSjug+QIaY0hnb36dPV+kQYlWPywuhDGcyHkvp95GK943wf5Ud4N7o/YdyG3U5Z2/dac/FLg9iczCXJGr1emJT+UYGiBP8A67+6p4G268tXGA6LjTvKD1CXKn3dWH/72jdC7n3qdmX9HblspObpKkicEwHy/y+aUsvwj3mJh24sZlzE7dT3NHMwvV/G3U5j3K0=
before_install:
- openssl aes-256-cbc -K $encrypted_be31fdac465d_key -iv $encrypted_be31fdac465d_iv
  -in deploy_key.enc -out deploy_key -d
- chmod 600 deploy_key
